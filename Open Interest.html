<!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8">  <title>Crypto Open Interest Tracker</title>  <meta name="viewport" content="width=device-width, initial-scale=1">  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  <style>    :root {      --primary: #ff6b35;      --bg-dark: #121212;      --bg-card: #1e1e1e;      --bg-hover: #2a2a2a;      --text-light: #ffffff;      --text-secondary: #888;      --success: #4caf50;      --error: #f44336;      --border: #333;      --shadow: rgba(0,0,0,0.3);    }        * {      box-sizing: border-box;      margin: 0;      padding: 0;    }        body {      background-color: var(--bg-dark);      color: var(--text-light);      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;      padding: 20px;      line-height: 1.6;    }        .container {      max-width: 1200px;      margin: 0 auto;    }        header {      text-align: center;      margin-bottom: 30px;      padding-bottom: 20px;      border-bottom: 1px solid var(--border);    }        h1 {      margin-bottom: 15px;      color: var(--primary);      font-size: 2.2rem;      display: flex;      align-items: center;      justify-content: center;      gap: 10px;    }        .controls {      display: flex;      flex-wrap: wrap;      gap: 20px;      margin-bottom: 30px;      justify-content: center;    }        .control-group {      background: var(--bg-card);      padding: 20px;      border-radius: 12px;      border: 1px solid var(--border);      flex: 1;      min-width: 280px;      max-width: 500px;    }        .control-group h2 {      font-size: 1.2rem;      margin-bottom: 15px;      color: var(--primary);      display: flex;      align-items: center;      gap: 8px;    }        .lang-buttons, .mode-buttons {      display: flex;      flex-wrap: wrap;      gap: 10px;      margin-top: 15px;    }        button {      padding: 10px 20px;      background: var(--bg-hover);      color: var(--text-light);      border: none;      border-radius: 8px;      cursor: pointer;      transition: all 0.3s ease;      font-weight: bold;      display: flex;      align-items: center;      gap: 8px;    }        button:hover {      background: #555;      transform: translateY(-2px);    }        button.active {      background: var(--primary);      box-shadow: 0 2px 10px rgba(255, 107, 53, 0.3);    }        #searchInput {      width: 100%;      padding: 12px;      font-size: 16px;      margin: 10px 0;      background: var(--bg-card);      color: var(--text-light);      border: 1px solid var(--border);      border-radius: 8px;    }        #symbolSelect {      width: 100%;      height: 300px;      background: var(--bg-card);      color: var(--text-light);      border: 1px solid var(--border);      border-radius: 8px;      overflow-y: auto;      padding: 10px;    }        .token-item {      padding: 10px;      cursor: pointer;      border-radius: 8px;      display: flex;      align-items: center;      gap: 10px;      transition: background 0.2s;    }        .token-item:hover {      background: var(--bg-hover);    }        .token-item.selected {      background: rgba(255, 107, 53, 0.2);      border-left: 3px solid var(--primary);    }        .token-icon {      width: 24px;      height: 24px;      border-radius: 50%;      object-fit: cover;    }        .stats {      display: flex;      justify-content: center;      gap: 20px;      margin: 30px 0;      flex-wrap: wrap;    }        .stat-item {      background: var(--bg-card);      padding: 20px;      border-radius: 12px;      border: 1px solid var(--border);      min-width: 180px;      transition: all 0.3s ease;      flex: 1;      text-align: center;    }        .stat-item:hover {      border-color: var(--primary);      transform: translateY(-2px);    }        .stat-label {      font-size: 14px;      color: var(--text-secondary);      margin-bottom: 8px;      text-transform: uppercase;      letter-spacing: 1px;    }        .stat-value {      font-size: 18px;      font-weight: bold;    }        #oiDisplay {      text-align: center;      font-size: 28px;      margin: 30px 0;      font-weight: bold;      color: var(--primary);      display: flex;      align-items: center;      justify-content: center;      gap: 15px;      flex-wrap: wrap;    }        #selectedTokenIcon {      width: 42px;      height: 42px;      border-radius: 50%;      object-fit: cover;    }        .chart-container {      position: relative;      height: 400px;      margin: 30px auto;      background: var(--bg-card);      border-radius: 15px;      padding: 20px;      box-shadow: 0 4px 20px var(--shadow);    }        .loading {      color: var(--primary);      font-size: 18px;      margin: 20px 0;      text-align: center;    }        .error {      color: var(--error);      font-size: 18px;      margin: 20px 0;      text-align: center;    }        .status-indicator {      display: flex;      align-items: center;      justify-content: center;      gap: 8px;      margin-top: 15px;      color: var(--text-secondary);      font-size: 14px;    }        .status-dot {      width: 10px;      height: 10px;      border-radius: 50%;      display: inline-block;    }        .status-connected {      background: var(--success);    }        .status-disconnected {      background: var(--error);    }        .status-polling {      background: #2196F3;    }        footer {      text-align: center;      margin-top: 40px;      padding-top: 20px;      color: var(--text-secondary);      font-size: 14px;      border-top: 1px solid var(--border);    }        @media (max-width: 768px) {      .stats {        flex-direction: column;        align-items: center;      }      .stat-item {        width: 100%;        max-width: 300px;      }      .chart-container {        padding: 15px;        height: 300px;      }      h1 {        font-size: 1.8rem;      }      #oiDisplay {        font-size: 22px;      }    }  </style></head><body>  <div class="container">    <header>      <h1><i class="fas fa-chart-line"></i> Crypto Open Interest Tracker</h1>    </header>        <div class="controls">      <div class="control-group">        <h2><i class="fas fa-coins"></i> Select Token</h2>        <input type="text" id="searchInput" placeholder="Search token..." oninput="filterSymbols()">        <div id="symbolSelect"></div>      </div>            <div class="control-group">        <h2><i class="fas fa-cog"></i> Settings</h2>                <div>          <h3><i class="fas fa-language"></i> Language</h3>          <div class="lang-buttons">            <button onclick="setLang('en')" id="btn-en"><i class="fas fa-globe-americas"></i> English</button>            <button onclick="setLang('ru')" id="btn-ru"><i class="fas fa-globe"></i> Русский</button>            <button onclick="setLang('ua')" id="btn-ua"><i class="fas fa-globe-europe"></i> Українська</button>          </div>        </div>                <div>          <h3><i class="fas fa-plug"></i> Connection Mode</h3>          <div class="mode-buttons">            <button onclick="setMode('websocket')" id="btn-websocket"><i class="fas fa-bolt"></i> WebSocket</button>            <button onclick="setMode('polling')" id="btn-polling"><i class="fas fa-sync-alt"></i> Polling (30s)</button>          </div>        </div>                <div class="status-indicator">          <span id="statusDot" class="status-dot status-disconnected"></span>          <span id="statusText">Disconnected</span>        </div>      </div>    </div>        <div class="stats">      <div class="stat-item">        <div class="stat-label" id="currentLabel">Current OI</div>        <div class="stat-value" id="currentValue">-</div>      </div>      <div class="stat-item">        <div class="stat-label" id="changeLabel">24h Change</div>        <div class="stat-value" id="changeValue">-</div>      </div>      <div class="stat-item">        <div class="stat-label" id="priceLabel">Price</div>        <div class="stat-value" id="priceValue">-</div>      </div>      <div class="stat-item">        <div class="stat-label" id="volumeLabel">24h Volume</div>        <div class="stat-value" id="volumeValue">-</div>      </div>    </div>        <div id="oiDisplay" class="loading">      <img id="selectedTokenIcon" src="" alt="" style="display: none;">      <span>Loading...</span>    </div>        <div class="chart-container">      <canvas id="oiChart"></canvas>    </div>        <footer>      <p>Crypto Open Interest Tracker &copy; 2025 | Real-time data from Binance Futures</p>      <p>Updated: <span id="lastUpdated">-</span></p>    </footer>  </div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>  <script>    const translations = {      en: {        title: "Open Interest Tracker for Cryptocurrencies",        placeholder: "Search token...",        oi: "Open Interest",        error: "Error loading data",        currentLabel: "Current OI",        changeLabel: "24h Change",        priceLabel: "Price",        volumeLabel: "24h Volume",        loading: "Loading...",        chartLabel: "Open Interest (USD)",        statusConnected: "Connected via WebSocket",        statusPolling: "Polling every 30 seconds",        statusDisconnected: "Disconnected",        lastUpdated: "Last updated:"      },      ru: {        title: "Трекер открытого интереса криптовалют",        placeholder: "Поиск токена...",        oi: "Открытый интерес",        error: "Ошибка загрузки данных",        currentLabel: "Текущий ОИ",        changeLabel: "Изменение 24ч",        priceLabel: "Цена",        volumeLabel: "Объем 24ч",        loading: "Загрузка...",        chartLabel: "Открытый интерес (USD)",        statusConnected: "Подключено через WebSocket",        statusPolling: "Обновление каждые 30 секунд",        statusDisconnected: "Отключено",        lastUpdated: "Последнее обновление:"      },      ua: {        title: "Трекер відкритого інтересу криптовалют",        placeholder: "Пошук токена...",        oi: "Відкритий інтерес",        error: "Помилка завантаження даних",        currentLabel: "Поточний ВІ",        changeLabel: "Зміна 24г",        priceLabel: "Ціна",        volumeLabel: "Об'єм 24г",        loading: "Завантаження...",        chartLabel: "Відкритий інтерес (USD)",        statusConnected: "Підключено через WebSocket",        statusPolling: "Оновлення кожні 30 секунд",        statusDisconnected: "Відключено",        lastUpdated: "Останнє оновлення:"      }    };    const originalSymbols = [      "BTCUSDT", "ETHUSDT", "BNBUSDT", "XRPUSDT", "SOLUSDT", "ADAUSDT", "AVAXUSDT", "DOGEUSDT",      "TRXUSDT", "DOTUSDT", "MATICUSDT", "SHIBUSDT", "LTCUSDT", "LINKUSDT", "BCHUSDT", "XLMUSDT",      "ATOMUSDT", "ETCUSDT", "UNIUSDT", "FILUSDT", "NEARUSDT", "MANAUSDT", "HBARUSDT", "VETUSDT",      "APTUSDT", "OPUSDT", "ARBUSDT", "INJUSDT", "MKRUSDT", "LDOUSDT", "GRTUSDT", "SNXUSDT",      "PEPEUSDT", "SUIUSDT", "FETUSDT", "SANDUSDT", "APEUSDT", "CHZUSDT", "AAVEUSDT", "COMPUSDT",      "CRVUSDT", "SUSHIUSDT", "YFIUSDT", "ALGOUSDT", "EOSUSDT", "NEOUSDT", "DASHUSDT", "ZECUSDT",      "RUNEUSDT", "IMXUSDT", "SEIUSDT", "RNDRUSDT", "COTIUSDT", "ENSUSDT", "MASKUSDT", "YGGUSDT",      "FLOKIUSDT", "BONKUSDT", "WIFUSDT", "BOMEUSDT", "MEMEUSDT", "DOGSUSDT", "NOTUSDT", "TONUSDT",      "XMRUSDT", "ZRXUSDT", "BATUSDT", "XTZUSDT", "QTUMUSDT", "IOSTUSDT", "ONTUSDT", "ZILUSDT",      "SCUSDT", "KAVAUSDT", "OMGUSDT", "IOTAUSDT", "ANKRUSDT", "BANDUSDT", "RLCUSDT", "WAVESUSDT",      "STORJUSDT", "KNCUSDT", "REEFUSDT", "STMXUSDT", "DGBUSDT", "CELRUSDT", "HOTUSDT", "MTLUSDT",      "OCEANUSDT", "BLZUSDT", "ANTUSDT", "ZENUSDT", "SKLUSDT", "RSRUSDT", "ARPAUSDT", "LRCUSDT",      "MATICUSDT", "MKRUSDT", "ENJUSDT", "ONEUSDT", "SXPUSDT", "SNTUSDT", "CTKUSDT", "CHRUSDT",      "BALUSDT", "NKNUSDT", "SRMUSDT", "CVCUSDT", "STXUSDT", "KSMUSDT", "DODOUSDT", "CAKEUSDT",      "ALPHAUSDT", "FRONTUSDT", "TVKUSDT", "BADGERUSDT", "FISUSDT", "LITUSDT", "TRBUSDT", "DENTUSDT",      "CELOUSDT", "HIVEUSDT", "GALAUSDT", "SFPUSDT", "DUSKUSDT", "FLMUSDT", "TWTUSDT", "REQUSDT",      "COSUSDT", "CTSIUSDT", "MDTUSDT", "TOMOUSDT", "PERPUSDT", "TROYUSDT", "RAYUSDT", "AKROUSDT",      "AUDIOUSDT", "BTSUSDT", "LSKUSDT", "ICXUSDT", "NMRUSDT", "CKBUSDT", "STRAXUSDT", "AVAUSDT",      "DIAUSDT", "BELUSDT", "WINGUSDT", "TRUUSDT", "OXTUSDT", "SUNUSDT", "AXSUSDT", "HNTUSDT",      "FTMUSDT", "RENUSDT", "C98USDT", "XEMUSDT", "TLMUSDT", "QUICKUSDT", "ALICEUSDT", "LINAUSDT",      "PROSUSDT", "VGXUSDT", "BICOUSDT", "FXSUSDT", "JASMYUSDT", "DARUSDT", "GALUSDT", "OPUSDT",      "INJUSDT", "STGUSDT", "SPELLUSDT", "1000SHIBUSDT", "1000LUNCUSDT", "1000PEPEUSDT", "1000FLOKIUSDT", "1000BONKUSDT",      "BLURUSDT", "MINAUSDT", "ROSEUSDT", "ACHUSDT", "IMXUSDT", "GLMRUSDT", "API3USDT", "GMTUSDT",      "APEUSDT", "GSTUSDT", "GNOUSDT", "LQTYUSDT", "SSVUSDT", "RPLUSDT", "USDCUSDT", "USDPUSDT",      "DAIUSDT", "BUSDUSDT", "TUSDUSDT", "PAXGUSDT", "XECUSDT", "XVSUSDT", "RUNEUSDT", "COMPUSDT",      "MKRUSDT", "YFIUSDT", "SNXUSDT", "UNIUSDT", "CRVUSDT", "1INCHUSDT", "ZECUSDT", "XMRUSDT",      "DASHUSDT", "ETCUSDT", "ZENUSDT", "RVNUSDT", "KAVAUSDT", "ANKRUSDT", "STMXUSDT", "HOTUSDT",      "PERLUSDT", "DATAUSDT", "ONGUSDT", "PHBUSDT", "VGXUSDT", "SYSUSDT", "REPV2USDT", "BTGUSDT",      "NEXOUSDT", "FUNUSDT", "COTIUSDT", "CHZUSDT", "MANAUSDT", "ALGOUSDT", "ENJUSDT", "SANDUSDT",      "THETAUSDT", "BANDUSDT", "RLCUSDT", "VITEUSDT", "FTTUSDT", "TOMOUSDT", "KMDUSDT", "ARDRUSDT",      "NEBLUSDT", "VTHOUSDT", "TCTUSDT", "TFUELUSDT", "DREPUSDT", "BEAMUSDT", "HBARUSDT", "STPTUSDT",      "SOLUSDT", "NEARUSDT", "DOTUSDT", "AVAXUSDT", "ICPUSDT", "FILUSDT", "LINKUSDT", "LTCUSDT",      "BCHUSDT", "EOSUSDT", "XLMUSDT", "TRXUSDT", "ADAUSDT", "XRPUSDT", "DOGEUSDT", "DOTUSDT",      "UNIUSDT", "BTCUSDT", "ETHUSDT"    ];    // FIX 1: Removed duplicate symbols using Set    const popularSymbols = [...new Set(originalSymbols)];    let currentLang = 'en';    let currentMode = 'polling';    let oiData = [];    let ws;    let chart;    let updateInterval;    let currentSymbol = 'BTCUSDT';    // FIX: Unified symbol handling for all sources    function getActualSymbol(symbol) {      const baseSymbol = symbol.replace('USDT', '').toUpperCase();      const specialCases = {        '1000SHIB': 'SHIB',        '1000LUNC': 'LUNC',        '1000PEPE': 'PEPE',        '1000FLOKI': 'FLOKI',        '1000BONK': 'BONK'      };      return specialCases[baseSymbol] || baseSymbol;    }    // FIX: Corrected icon URLs    function getTokenIconUrl(symbol) {      const actualSymbol = getActualSymbol(symbol);      return `https://cdn.jsdelivr.net/gh/atomiclabs/cryptocurrency-icons@1a63530be6e374711a8554f31b17e4cb92c25fa5/svg/color/${actualSymbol.toLowerCase()}.svg`;    }    // FIX: Improved error handling with correct URLs    function handleIconError(imgElement, symbol) {      const actualSymbol = getActualSymbol(symbol);            // 1. Try Binance futures icons (correct URL)      imgElement.src = `https://bin.bnbstatic.com/static/images/common/future/${actualSymbol}.png`;      imgElement.onerror = () => {        // 2. Try TrustWallet general API        imgElement.src = `https://assets.trustwalletapp.com/blockchains/ethereum/assets/${actualSymbol}/logo.png`;        imgElement.onerror = () => {          // 3. Try CoinGecko API          fetch(`https://api.coingecko.com/api/v3/coins/${actualSymbol.toLowerCase()}?localization=false`)            .then(response => response.json())            .then(data => {              if (data.image && data.image.small) {                imgElement.src = data.image.small;              } else {                fallbackIcon(imgElement);              }            })            .catch(() => fallbackIcon(imgElement));        };      };    }    function fallbackIcon(imgElement) {      imgElement.src = 'https://cdn.jsdelivr.net/gh/atomiclabs/cryptocurrency-icons@1a63530be6e374711a8554f31b17e4cb92c25fa5/svg/color/generic.svg';      imgElement.onerror = null;    }    function initChart() {      if (chart) {        chart.destroy();      }      const ctx = document.getElementById("oiChart").getContext("2d");      chart = new Chart(ctx, {        type: "line",        data: {          labels: [],          datasets: [{            label: translations[currentLang].chartLabel,            data: [],            borderColor: "#ff6b35",            backgroundColor: "rgba(255,107,53,0.1)",            fill: true,            tension: 0.4,            pointRadius: 2,            pointHoverRadius: 8,            pointBackgroundColor: "#ff6b35",            pointBorderColor: "#fff",            pointBorderWidth: 2,            borderWidth: 3          }]        },        options: {          responsive: true,          maintainAspectRatio: false,          animation: {            duration: 750,            easing: 'easeInOutQuart'          },          scales: {            y: {              ticks: {                color: "#ffffff",                callback: function(value) {                  return formatNumber(value) + ' USD';                }              },              grid: {                color: "rgba(255,255,255,0.1)",                drawBorder: false              },              beginAtZero: false            },            x: {              ticks: {                color: "#ffffff",                maxTicksLimit: 10              },              grid: {                color: "rgba(255,255,255,0.1)",                drawBorder: false              }            }          },          plugins: {            legend: {               labels: {                color: '#ffffff',                font: {                  size: 14,                  weight: 'bold'                }              }            },            tooltip: {              backgroundColor: 'rgba(0,0,0,0.9)',              titleColor: '#ff6b35',              bodyColor: '#ffffff',              borderColor: '#ff6b35',              borderWidth: 1,              cornerRadius: 8,              displayColors: false,              callbacks: {                label: function(context) {                  return translations[currentLang].chartLabel + ': ' + formatNumber(context.parsed.y) + ' USD';                }              }            }          },          interaction: {            intersect: false,            mode: 'index'          },          elements: {            point: {              hoverRadius: 10            }          }        }      });    }    function formatNumber(num) {      if (!num) return '0';      if (num >= 1e12) {        return (num / 1e12).toFixed(2) + 'T';      } else if (num >= 1e9) {        return (num / 1e9).toFixed(2) + 'B';      } else if (num >= 1e6) {        return (num / 1e6).toFixed(2) + 'M';      } else if (num >= 1e3) {        return (num / 1e3).toFixed(2) + 'K';      }      return num.toLocaleString();    }    function populateSymbols(list = popularSymbols) {      const symbolSelect = document.getElementById("symbolSelect");      symbolSelect.innerHTML = '';      list.forEach(symbol => {        const tokenItem = document.createElement("div");        tokenItem.className = "token-item";        tokenItem.dataset.symbol = symbol;        if (symbol === currentSymbol) {          tokenItem.classList.add("selected");        }        const baseSymbol = symbol.replace('USDT', '');        const iconUrl = getTokenIconUrl(symbol);                tokenItem.innerHTML = `          <img src="${iconUrl}" alt="${baseSymbol}" class="token-icon">          <span>${symbol}</span>        `;                // FIX: Add error handling for each icon        const iconElement = tokenItem.querySelector('.token-icon');        iconElement.onerror = () => handleIconError(iconElement, symbol);                tokenItem.addEventListener("click", () => {          document.querySelectorAll('.token-item').forEach(el => el.classList.remove('selected'));          tokenItem.classList.add("selected");          selectSymbol(symbol);        });        symbolSelect.appendChild(tokenItem);      });    }    function filterSymbols() {      const query = document.getElementById("searchInput").value.toUpperCase();      const filtered = popularSymbols.filter(sym => sym.includes(query));      populateSymbols(filtered);    }    function selectSymbol(symbol) {      currentSymbol = symbol;      oiData = [];      const oiDisplay = document.getElementById("oiDisplay");      oiDisplay.querySelector('span').textContent = translations[currentLang].loading;      oiDisplay.className = 'loading';      const iconElement = document.getElementById("selectedTokenIcon");      const iconUrl = getTokenIconUrl(symbol);            // FIX: Enhanced icon handling for selected token      iconElement.src = iconUrl;      iconElement.style.display = 'block';      iconElement.onerror = () => handleIconError(iconElement, symbol);            if (chart) {        chart.data.labels = [];        chart.data.datasets[0].data = [];        chart.update('none');      }      // Re-setup connection for the new symbol      setMode(currentMode);    }    function setLang(lang) {      currentLang = lang;      const t = translations[lang];      document.querySelectorAll('.lang-buttons button').forEach(btn => {        btn.classList.remove('active');      });      document.getElementById(`btn-${lang}`).classList.add('active');      document.querySelector("h1").innerHTML = `<i class="fas fa-chart-line"></i> ${t.title}`;      document.getElementById("searchInput").placeholder = t.placeholder;      document.getElementById("currentLabel").textContent = t.currentLabel;      document.getElementById("changeLabel").textContent = t.changeLabel;      document.getElementById("priceLabel").textContent = t.priceLabel;      document.getElementById("volumeLabel").textContent = t.volumeLabel;      if (chart && chart.data.datasets[0]) {        chart.data.datasets[0].label = t.chartLabel;        chart.update('none');      }      updateStatus();      if (currentSymbol) {        const oiDisplay = document.getElementById("oiDisplay");        if (oiDisplay.className !== 'loading' && oiDisplay.className !== 'error') {          oiDisplay.querySelector('span').textContent =            `${t.oi}: ${oiData.length > 0 ? formatNumber(oiData[oiData.length-1].value) : '-'} USD`;        }      }    }    function setMode(mode) {        currentMode = mode;        document.querySelectorAll('.mode-buttons button').forEach(btn => {            btn.classList.remove('active');        });        document.getElementById(`btn-${mode}`).classList.add('active');                // Clear existing connections/intervals        if (ws) {            ws.close();            ws = null;        }        if (updateInterval) {            clearInterval(updateInterval);            updateInterval = null;        }        // Setup new connection        if (currentSymbol) {            if (mode === 'websocket') {                setupWebSocket(currentSymbol);            } else { // polling                update(currentSymbol); // Immediate update                updateInterval = setInterval(() => update(currentSymbol), 30000);            }        }        updateStatus();    }    function updateStatus() {      const statusDot = document.getElementById("statusDot");      const statusText = document.getElementById("statusText");      const t = translations[currentLang];      statusDot.className = 'status-dot';      if (currentMode === 'websocket') {        if (ws && ws.readyState === WebSocket.OPEN) {          statusDot.classList.add('status-connected');          statusText.textContent = t.statusConnected;        } else {          statusDot.classList.add('status-disconnected');          statusText.textContent = t.statusDisconnected;        }      } else {        statusDot.classList.add('status-polling');        statusText.textContent = t.statusPolling;      }    }    async function fetchOpenInterest(symbol) {      try {        const controller = new AbortController();        const timeoutId = setTimeout(() => controller.abort(), 10000);        const [oiRes, priceRes, tickerRes] = await Promise.all([          fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${symbol}`, { signal: controller.signal }),          fetch(`https://fapi.binance.com/fapi/v1/ticker/price?symbol=${symbol}`, { signal: controller.signal }),          fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${symbol}`, { signal: controller.signal })        ]);        clearTimeout(timeoutId);        if (!oiRes.ok) throw new Error(`Open Interest API error: ${oiRes.status}`);        if (!priceRes.ok) throw new Error(`Price API error: ${priceRes.status}`);        if (!tickerRes.ok) throw new Error(`Ticker API error: ${tickerRes.status}`);        const oi = await oiRes.json();        const price = await priceRes.json();        const ticker = await tickerRes.json();        const openInterestUSD = parseFloat(oi.openInterest) * parseFloat(price.price);        const priceChange = parseFloat(ticker.priceChangePercent);        const currentPrice = parseFloat(price.price);        const volume = parseFloat(ticker.quoteVolume); // Use quoteVolume for USD volume        return {          openInterest: openInterestUSD,          price: currentPrice,          change24h: priceChange,          volume: volume,          symbol: symbol        };      } catch (err) {        console.error("Error loading data:", err);        throw err;      }    }    function updateDisplay(data) {      const locale = currentLang === 'ru' ? 'ru-RU' : currentLang === 'ua' ? 'uk-UA' : 'en-US';      document.getElementById("currentValue").textContent =        formatNumber(data.openInterest) + " USD";      const changeElement = document.getElementById("changeValue");      changeElement.textContent = (data.change24h >= 0 ? "+" : "") + data.change24h.toFixed(2) + "%";      changeElement.style.color = data.change24h >= 0 ? "#4caf50" : "#f44336";      document.getElementById("priceValue").textContent =        "$" + data.price.toLocaleString(locale, {          minimumFractionDigits: 2,          maximumFractionDigits: data.price > 1 ? 2 : 6        });      document.getElementById("volumeValue").textContent =        formatNumber(data.volume) + " USD";      const now = new Date();      const timeLabel = now.toLocaleTimeString(locale, {        hour: '2-digit',        minute: '2-digit',        second: '2-digit'      });      document.getElementById("oiDisplay").querySelector('span').textContent =        `${translations[currentLang].oi}: ${formatNumber(data.openInterest)} USD`;      document.getElementById("oiDisplay").className = '';      document.getElementById("lastUpdated").textContent =        now.toLocaleString(locale, {          year: 'numeric',          month: 'short',          day: 'numeric',          hour: '2-digit',          minute: '2-digit',          second: '2-digit'        });      if (oiData.length >= 30) {        oiData.shift();      }      oiData.push({        time: timeLabel,        value: data.openInterest,        timestamp: now.getTime()      });      if (chart) {        chart.data.labels = oiData.map(p => p.time);        chart.data.datasets[0].data = oiData.map(p => p.value);        // FIX 3: Correct chart update call        chart.update();      }    }    async function update(symbol) {      try {        const data = await fetchOpenInterest(symbol);        updateDisplay(data);      } catch (err) {        const oiDisplay = document.getElementById("oiDisplay");        oiDisplay.querySelector('span').textContent = translations[currentLang].error;        oiDisplay.className = 'error';      }    }    // FIX 2: More efficient WebSocket handling    function setupWebSocket(symbol) {      if (ws) {        ws.close();      }      if(updateInterval) {        clearInterval(updateInterval);      }      const streamName = `${symbol.toLowerCase()}@ticker`;      ws = new WebSocket(`wss://fstream.binance.com/ws/${streamName}`);      ws.onopen = () => {        console.log(`WebSocket connected for ${symbol}`);        updateStatus();        // Fetch full data immediately on connection        update(symbol);        // Then, set an interval to periodically refresh the full data (including OI)        updateInterval = setInterval(() => update(symbol), 30000);      };            ws.onmessage = (event) => {        // This part only provides visual real-time price updates while the main update runs on a timer.        try {          const data = JSON.parse(event.data);          const price = parseFloat(data.c);          const change24h = parseFloat(data.P);          const volume = parseFloat(data.q); // Quote asset volume          // Only update the faster-moving stats visually          document.getElementById("priceValue").textContent =            "$" + price.toLocaleString(currentLang === 'ru' ? 'ru-RU' : 'en-US', {              minimumFractionDigits: 2,              maximumFractionDigits: price > 1 ? 2 : 6            });                    const changeElement = document.getElementById("changeValue");          changeElement.textContent = (change24h >= 0 ? "+" : "") + change24h.toFixed(2) + "%";          changeElement.style.color = change24h >= 0 ? "#4caf50" : "#f44336";                    document.getElementById("volumeValue").textContent = formatNumber(volume) + " USD";        } catch (err) {          console.error("WebSocket message processing error:", err);        }      };      ws.onerror = (error) => {        console.error("WebSocket error:", error);        updateStatus();      };      ws.onclose = () => {        console.log("WebSocket closed");        // Clean up the interval when WS closes        if (updateInterval) {            clearInterval(updateInterval);            updateInterval = null;        }        updateStatus();      };    }        // FIX 4: Set copyright year dynamically    function setCopyrightYear() {        const footer = document.querySelector("footer p:first-of-type");        if (footer) {            footer.innerHTML = `Crypto Open Interest Tracker &copy; ${new Date().getFullYear()} | Real-time data from Binance Futures`;        }    }    function initApp() {      initChart();      setLang('en');      populateSymbols();      selectSymbol('BTCUSDT');      setMode('polling');      setCopyrightYear();    }        document.addEventListener('DOMContentLoaded', initApp);    window.addEventListener('beforeunload', () => {      if (ws) ws.close();      if (updateInterval) clearInterval(updateInterval);    });  </script></body></html>