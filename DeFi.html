<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DeFi Guide</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300">

  <!-- Header -->
  <header class="bg-purple-800 text-white p-4 md:p-6 flex justify-between items-center">
    <h1 id="header-title" class="text-xl md:text-2xl font-bold">DeFi Guide</h1>
    <div class="flex items-center space-x-2 md:space-x-4">
      <!-- Updated theme button (smaller) -->
      <button id="themeToggle" class="bg-white text-purple-800 p-2 rounded-full w-10 h-10 flex items-center justify-center" title="Toggle theme">
        <span id="themeIcon">üåô</span>
      </button>
      
      <!-- Language Selector -->
      <select id="languageSelect" class="bg-white text-purple-800 px-3 py-1.5 rounded text-sm md:text-base">
        <option value="en">English</option>
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
      </select>
    </div>
  </header>

  <!-- Hero -->
  <section class="bg-purple-100 dark:bg-purple-900 p-6 text-center">
    <h2 class="text-2xl md:text-3xl font-bold">üåê <span data-translate-key="hero-title">What is DeFi?</span></h2>
    <p class="max-w-3xl mx-auto mt-2" data-translate-key="hero-subtitle">Powerful network of financial services without banks or intermediaries.</p>
  </section>

  <!-- Search Tokens -->
  <section class="p-4 md:p-6 max-w-4xl mx-auto">
    <label class="font-bold text-sm md:text-base" data-translate-key="search-label">üîç Search token:</label>
    <input id="searchInput" type="text" placeholder="" 
           class="w-full mt-2 p-2 border rounded bg-purple-50 dark:bg-gray-700 text-sm md:text-base"/>
  </section>

  <!-- Token prices -->
  <section class="p-4 md:p-6 max-w-6xl mx-auto">
    <h2 class="text-xl md:text-2xl font-bold text-center mb-4" data-translate-key="tokens-title">üìä DeFi Tokens (live)</h2>
    <div id="tokens" class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
      <div class="text-center p-4 bg-purple-100 dark:bg-gray-700 rounded">
        <p data-translate-key="loading-text">Loading...</p>
      </div>
    </div>
  </section>

  <!-- TVL chart -->
  <section class="p-4 md:p-6 max-w-6xl mx-auto">
    <h2 class="text-xl md:text-2xl font-bold text-center mb-4" data-translate-key="tvl-title">üìà Total Value Locked (TVL)</h2>
    <div class="relative">
      <canvas id="tvlChart" class="bg-white dark:bg-gray-800 p-4 rounded shadow"></canvas>
      <div id="chartLoader" class="absolute inset-0 bg-white dark:bg-gray-800 bg-opacity-80 flex items-center justify-center hidden">
        <p class="text-purple-600 dark:text-purple-400 font-medium">Loading chart...</p>
      </div>
      <div id="chartError" class="absolute inset-0 bg-white dark:bg-gray-800 flex items-center justify-center hidden">
        <p class="text-red-500 text-center p-4"></p>
      </div>
    </div>
  </section>

  <!-- News Sources Section -->
  <section class="p-4 md:p-6 bg-gray-100 dark:bg-gray-800 max-w-6xl mx-auto">
    <h2 class="text-xl md:text-2xl font-bold text-center mb-4 md:mb-6" data-translate-key="news-title">üì∞ DeFi News Sources</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
      <!-- Telegram Sources -->
      <div>
        <h3 class="text-lg md:text-xl font-bold mb-3 md:mb-4 flex items-center">
          <svg class="w-5 h-5 md:w-6 md:h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.447 1.394c-.14.141-.259.259-.374.261l.213-3.053 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.136-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
          </svg>
          Telegram
        </h3>
        <ul class="space-y-2 md:space-y-3">
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://t.me/DeFimillion" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">DeFi Million</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">@DeFimillion</span>
            </a>
          </li>
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://t.me/defillama_tg" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">DefiLlama Round Up</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">@defillama_tg</span>
            </a>
          </li>
        </ul>
      </div>
      
      <!-- Twitter Sources -->
      <div>
        <h3 class="text-lg md:text-xl font-bold mb-3 md:mb-4 flex items-center">
          <svg class="w-5 h-5 md:w-6 md:h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
          </svg>
          X (Twitter)
        </h3>
        <ul class="space-y-2 md:space-y-3">
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://twitter.com/Definews_Info" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">DEFI NEWS</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">@Definews_Info</span>
            </a>
          </li>
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://twitter.com/DeFi" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">De.Fi</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">@DeFi</span>
            </a>
          </li>
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://twitter.com/todayindefi" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">Today in DeFi</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">@todayindefi</span>
            </a>
          </li>
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://twitter.com/DeFiChain" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">DeFiChain</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">@DeFiChain</span>
            </a>
          </li>
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://twitter.com/DeFiSaver" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">DeFiSaver</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">@DeFiSaver</span>
            </a>
          </li>
          <li class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow hover:bg-purple-50 dark:hover:bg-gray-600 transition">
            <a href="https://twitter.com/hashtag/DeFi" target="_blank" class="flex items-center text-purple-600 dark:text-purple-400 hover:underline">
              <span class="font-medium">#DeFi</span>
              <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded" data-translate-key="trends">Trends</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Events Calendar -->
  <section class="p-4 md:p-6 max-w-4xl mx-auto">
    <h2 class="text-xl md:text-2xl font-bold mb-3 md:mb-4" data-translate-key="events-title">üìÖ DeFi Events</h2>
    <ul id="eventsList" class="list-disc pl-5 space-y-1 md:space-y-2 text-gray-800 dark:text-gray-200 text-sm md:text-base">
      <li><em data-translate-key="events-loading">Loading events...</em></li>
    </ul>
  </section>

  <!-- Telegram Widget -->
  <section class="p-4 md:p-6 bg-gray-50 dark:bg-gray-800 max-w-4xl mx-auto">
    <h2 class="text-lg md:text-xl font-bold mb-2" data-translate-key="telegram-title">Latest from Telegram:</h2>
    <blockquote class="p-3 md:p-4 bg-white dark:bg-gray-700 rounded shadow">
      <p><em data-translate-key="telegram-message">üöÄ New TVL record reached - over $100 billion!</em></p>
    </blockquote>
  </section>

  <!-- Footer -->
  <footer class="bg-purple-800 text-white p-3 md:p-4 text-center text-xs md:text-sm">
    <span data-translate-key="footer-text">&copy; 2025 DeFi Guide. With love for the community.</span>
  </footer>

  <!-- Scripts -->
  <script>
    // ================== TRANSLATIONS ==================
    const translations = {
      en: {
        "header-title": "DeFi Guide",
        "theme-button": "üåô Theme",
        "hero-title": "What is DeFi?",
        "hero-subtitle": "Powerful network of financial services without banks or intermediaries.",
        "search-label": "üîç Search token:",
        "search-placeholder": "e.g. Uniswap or UNI",
        "tokens-title": "üìä DeFi Tokens (live)",
        "loading-text": "Loading...",
        "tvl-title": "üìà Total Value Locked (TVL)",
        "news-title": "üì∞ DeFi News Sources",
        "trends": "Trends",
        "events-title": "üìÖ DeFi Events",
        "events-loading": "Loading events...",
        "event-types": {
          "launch": "New protocol launch",
          "update": "Major update",
          "ama": "Community AMA",
          "partnership": "Partnership announcement",
          "governance": "Governance proposal",
          "conference": "Conference event"
        },
        "month-jan": "January",
        "month-feb": "February",
        "month-mar": "March",
        "month-apr": "April",
        "month-may": "May",
        "month-jun": "June",
        "month-jul": "July",
        "month-aug": "August",
        "month-sep": "September",
        "month-oct": "October",
        "month-nov": "November",
        "month-dec": "December",
        "telegram-title": "Latest from Telegram:",
        "telegram-message": "üöÄ New TVL record reached - over $100 billion!",
        "footer-text": "¬© 2025 DeFi Guide. With love for the community."
      },
      ru: {
        "header-title": "DeFi –ì–∏–¥",
        "theme-button": "üåô –¢–µ–º–∞",
        "hero-title": "–ß—Ç–æ —Ç–∞–∫–æ–µ DeFi?",
        "hero-subtitle": "–ú–æ—â–Ω–∞—è —Å–µ—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –±–∞–Ω–∫–æ–≤ –∏ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤.",
        "search-label": "üîç –ü–æ–∏—Å–∫ —Ç–æ–∫–µ–Ω–∞:",
        "search-placeholder": "–ù–∞–ø—Ä–∏–º–µ—Ä: Uniswap –∏–ª–∏ UNI",
        "tokens-title": "üìä –¢–æ–∫–µ–Ω—ã DeFi (live)",
        "loading-text": "–ó–∞–≥—Ä—É–∑–∫–∞...",
        "tvl-title": "üìà Total Value Locked (TVL)",
        "news-title": "üì∞ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π DeFi",
        "trends": "–¢—Ä–µ–Ω–¥—ã",
        "events-title": "üìÖ –°–æ–±—ã—Ç–∏—è DeFi",
        "events-loading": "–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...",
        "event-types": {
          "launch": "–ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞",
          "update": "–ö—Ä—É–ø–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",
          "ama": "–°–µ—Å—Å–∏—è AMA —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º",
          "partnership": "–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–µ",
          "governance": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é",
          "conference": "–ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è"
        },
        "month-jan": "–Ø–Ω–≤–∞—Ä—å",
        "month-feb": "–§–µ–≤—Ä–∞–ª—å",
        "month-mar": "–ú–∞—Ä—Ç",
        "month-apr": "–ê–ø—Ä–µ–ª—å",
        "month-may": "–ú–∞–π",
        "month-jun": "–ò—é–Ω—å",
        "month-jul": "–ò—é–ª—å",
        "month-aug": "–ê–≤–≥—É—Å—Ç",
        "month-sep": "–°–µ–Ω—Ç—è–±—Ä—å",
        "month-oct": "–û–∫—Ç—è–±—Ä—å",
        "month-nov": "–ù–æ—è–±—Ä—å",
        "month-dec": "–î–µ–∫–∞–±—Ä—å",
        "telegram-title": "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑ Telegram:",
        "telegram-message": "üöÄ –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥ TVL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç - –±–æ–ª–µ–µ $100 –º–ª—Ä–¥!",
        "footer-text": "¬© 2025 DeFi –ì–∏–¥. –° –ª—é–±–æ–≤—å—é –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞."
      },
      uk: {
        "header-title": "DeFi –ì—ñ–¥",
        "theme-button": "üåô –¢–µ–º–∞",
        "hero-title": "–©–æ —Ç–∞–∫–µ DeFi?",
        "hero-subtitle": "–ü–æ—Ç—É–∂–Ω–∞ –º–µ—Ä–µ–∂–∞ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –±–µ–∑ –±–∞–Ω–∫—ñ–≤ —Ç–∞ –ø–æ—Å–µ—Ä–µ–¥–Ω–∏–∫—ñ–≤.",
        "search-label": "üîç –ü–æ—à—É–∫ —Ç–æ–∫–µ–Ω–∞:",
        "search-placeholder": "–ù–∞–ø—Ä–∏–∫–ª–∞–¥: Uniswap –∞–±–æ UNI",
        "tokens-title": "üìä –¢–æ–∫–µ–Ω–∏ DeFi (live)",
        "loading-text": "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...",
        "tvl-title": "üìà Total Value Locked (TVL)",
        "news-title": "üì∞ –î–∂–µ—Ä–µ–ª–∞ –Ω–æ–≤–∏–Ω DeFi",
        "trends": "–¢—Ä–µ–Ω–¥–∏",
        "events-title": "üìÖ –ü–æ–¥—ñ—ó DeFi",
        "events-loading": "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–¥—ñ–π...",
        "event-types": {
          "launch": "–ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É",
          "update": "–í–µ–ª–∏–∫–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è",
          "ama": "–°–µ—Å—ñ—è AMA –∑—ñ —Å–ø—ñ–ª—å–Ω–æ—Ç–æ—é",
          "partnership": "–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–∞",
          "governance": "–ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –∑ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è",
          "conference": "–ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü—ñ—è"
        },
        "month-jan": "–°—ñ—á–µ–Ω—å",
        "month-feb": "–õ—é—Ç–∏–π",
        "month-mar": "–ë–µ—Ä–µ–∑–µ–Ω—å",
        "month-apr": "–ö–≤—ñ—Ç–µ–Ω—å",
        "month-may": "–¢—Ä–∞–≤–µ–Ω—å",
        "month-jun": "–ß–µ—Ä–≤–µ–Ω—å",
        "month-jul": "–õ–∏–ø–µ–Ω—å",
        "month-aug": "–°–µ—Ä–ø–µ–Ω—å",
        "month-sep": "–í–µ—Ä–µ—Å–µ–Ω—å",
        "month-oct": "–ñ–æ–≤—Ç–µ–Ω—å",
        "month-nov": "–õ–∏—Å—Ç–æ–ø–∞–¥",
        "month-dec": "–ì—Ä—É–¥–µ–Ω—å",
        "telegram-title": "–û—Å—Ç–∞–Ω–Ω—î –∑ Telegram:",
        "telegram-message": "üöÄ –ù–æ–≤–∏–π —Ä–µ–∫–æ—Ä–¥ TVL –¥–æ—Å—è–≥–Ω—É—Ç–æ ‚Äî –±—ñ–ª—å—à–µ $100 –º–ª—Ä–¥!",
        "footer-text": "¬© 2025 DeFi –ì—ñ–¥. –ó –ª—é–±–æ–≤'—é –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ—Ç–∏."
      }
    };

    // Language management
    function setLanguage(lang) {
      // Update text elements
      document.querySelectorAll('[data-translate-key]').forEach(el => {
        const key = el.getAttribute('data-translate-key');
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });
      
      // Update placeholder
      const searchInput = document.getElementById('searchInput');
      if (translations[lang]['search-placeholder']) {
        searchInput.placeholder = translations[lang]['search-placeholder'];
      }
      
      // Update HTML lang attribute
      document.documentElement.lang = lang;
      
      // Save preference
      localStorage.setItem('preferredLanguage', lang);
      
      // Reinitialize components that depend on language
      initEventsCalendar();
    }

    // Initialize language
    function initLanguage() {
      // Get saved language or default to English
      const savedLang = localStorage.getItem('preferredLanguage') || 'en';
      document.getElementById('languageSelect').value = savedLang;
      setLanguage(savedLang);
    }

    // ================== OTHER FUNCTIONS ==================
    // Theme toggle with icon change
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    
    themeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      themeIcon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      themeToggle.title = isDark ? 'Switch to light theme' : 'Switch to dark theme';
    });

    // Load tokens from CoinGecko API
    async function loadTokens() {
      try {
        const container = document.getElementById('tokens');
        container.innerHTML = `
          <div class="col-span-full text-center p-4">
            <p>${translations[document.documentElement.lang]['loading-text']}</p>
          </div>
        `;
        
        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&category=decentralized_finance_defi&order=market_cap_desc&per_page=20&sparkline=false&price_change_percentage=24h');
        const tokens = await response.json();
        
        container.innerHTML = tokens.map(token => `
          <a href="https://www.coingecko.com/en/coins/${token.id}" target="_blank" class="bg-purple-100 dark:bg-gray-700 p-3 rounded shadow hover:bg-purple-200 dark:hover:bg-gray-600 transition cursor-pointer">
            <img src="${token.image}" class="w-10 h-10 mx-auto mb-2" />
            <h3 class="font-bold text-sm md:text-base">${token.name}</h3>
            <p class="text-sm md:text-base">$${token.current_price.toFixed(2)}</p>
            <p class="text-xs md:text-sm ${token.price_change_percentage_24h > 0 ? 'text-green-500' : 'text-red-500'}">
              ${token.price_change_percentage_24h.toFixed(1)}%
            </p>
          </a>
        `).join('');
      } catch (error) {
        console.error('Error loading tokens:', error);
        document.getElementById('tokens').innerHTML = `
          <div class="col-span-full text-center p-4">
            <p class="text-red-500">${translations[document.documentElement.lang]['loading-text'] || 'Error loading data'}</p>
          </div>
        `;
      }
    }

    // Updated TVL chart implementation
    async function initTVLChart() {
      const chartLoader = document.getElementById('chartLoader');
      const chartError = document.getElementById('chartError');
      const chartErrorText = chartError.querySelector('p');
      
      try {
        chartLoader.classList.remove('hidden');
        chartError.classList.add('hidden');

        const res = await fetch("https://api.llama.fi/charts");
        if (!res.ok) throw new Error('API error: ' + res.status);
        const data = await res.json();

        const labels = data.map(d => new Date(d.date * 1000).toLocaleDateString());
        const tvlValues = data.map(d => d.totalLiquidityUSD / 1e9);

        const ctx = document.getElementById('tvlChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'TVL (–º–ª—Ä–¥ $)',
              data: tvlValues,
              borderColor: '#8b5cf6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              fill: true,
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                labels: {
                  color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                  font: { size: 14 }
                }
              },
              tooltip: {
                mode: 'index',
                intersect: false,
                callbacks: {
                  label: context => `TVL: $${context.parsed.y.toFixed(2)}B`
                }
              }
            },
            scales: {
              y: {
                beginAtZero: false,
                ticks: {
                  color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                  callback: value => '$' + value + 'B'
                },
                grid: {
                  color: document.documentElement.classList.contains('dark') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                }
              },
              x: {
                ticks: {
                  color: document.documentElement.classList.contains('dark') ? '#fff' : '#000'
                },
                grid: {
                  color: document.documentElement.classList.contains('dark') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                }
              }
            }
          }
        });

        chartLoader.classList.add('hidden');
      } catch (error) {
        chartLoader.classList.add('hidden');
        chartErrorText.textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∞: ' + error.message;
        chartError.classList.remove('hidden');
      }
    }

    // Initialize events calendar
    function initEventsCalendar() {
      const eventsList = document.getElementById('eventsList');
      eventsList.innerHTML = '';
      
      const today = new Date();
      const currentMonth = today.getMonth();
      const currentYear = today.getFullYear();
      
      // Generate events for current and previous month
      for (let monthOffset = 0; monthOffset >= -1; monthOffset--) {
        const month = (currentMonth + monthOffset + 12) % 12;
        const year = currentYear + Math.floor((currentMonth + monthOffset) / 12);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        const monthNames = [
          'month-jan', 'month-feb', 'month-mar', 'month-apr',
          'month-may', 'month-jun', 'month-jul', 'month-aug',
          'month-sep', 'month-oct', 'month-nov', 'month-dec'
        ];
        
        const monthName = translations[document.documentElement.lang][monthNames[month]];
        
        // Add month header
        const monthHeader = document.createElement('li');
        monthHeader.className = 'font-bold mt-3 list-none';
        monthHeader.textContent = `${monthName} ${year}`;
        eventsList.appendChild(monthHeader);
        
        // Generate 3-5 random events for the month
        const eventCount = Math.floor(Math.random() * 3) + 3;
        const eventDays = [];
        
        while (eventDays.length < eventCount) {
          const day = Math.floor(Math.random() * daysInMonth) + 1;
          if (!eventDays.includes(day)) {
            eventDays.push(day);
          }
        }
        
        eventDays.sort((a, b) => a - b).forEach(day => {
          const eventItem = document.createElement('li');
          eventItem.className = 'ml-4';
          
          const eventTypes = Object.keys(translations[document.documentElement.lang]['event-types']);
          const randomEventType = eventTypes[Math.floor(Math.random() * eventTypes.length)];
          const eventText = translations[document.documentElement.lang]['event-types'][randomEventType];
          
          eventItem.innerHTML = `
            <strong>${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}:</strong>
            <span>${eventText}</span>
          `;
          eventsList.appendChild(eventItem);
        });
      }
    }

    // Token search functionality with debounce
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', async (e) => {
      const searchTerm = e.target.value.trim().toLowerCase();
      
      // Clear previous timeout
      clearTimeout(searchTimeout);
      
      // Set new timeout for debounce (300ms)
      searchTimeout = setTimeout(async () => {
        if (!searchTerm) return loadTokens();
        
        try {
          const container = document.getElementById('tokens');
          container.innerHTML = `
            <div class="col-span-full text-center p-4">
              <p>${translations[document.documentElement.lang]['loading-text']}</p>
            </div>
          `;
          
          const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&sparkline=false');
          const allTokens = await response.json();
          
          const filteredTokens = allTokens.filter(token => 
            token.name.toLowerCase().includes(searchTerm) || 
            token.symbol.toLowerCase().includes(searchTerm)
          );
          
          container.innerHTML = filteredTokens.slice(0, 8).map(token => `
            <a href="https://www.coingecko.com/en/coins/${token.id}" target="_blank" class="bg-purple-100 dark:bg-gray-700 p-3 rounded shadow hover:bg-purple-200 dark:hover:bg-gray-600 transition cursor-pointer">
              <img src="${token.image}" class="w-10 h-10 mx-auto mb-2" />
              <h3 class="font-bold text-sm md:text-base">${token.name}</h3>
              <p class="text-sm md:text-base">$${token.current_price.toFixed(2)}</p>
              <p class="text-xs md:text-sm ${token.price_change_percentage_24h > 0 ? 'text-green-500' : 'text-red-500'}">
                ${token.price_change_percentage_24h?.toFixed(1) || '0.0'}%
              </p>
            </a>
          `).join('');
        } catch (error) {
          console.error('Search error:', error);
        }
      }, 300);
    });

    // Initialize all components
    window.addEventListener('DOMContentLoaded', () => {
      // Initialize language system
      initLanguage();
      
      // Set initial theme icon
      themeIcon.textContent = document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
      themeToggle.title = document.documentElement.classList.contains('dark') ? 
        'Switch to light theme' : 'Switch to dark theme';
      
      // Language change handler
      document.getElementById('languageSelect').addEventListener('change', (e) => {
        setLanguage(e.target.value);
      });
      
      // Load other components
      loadTokens();
      initTVLChart();
      initEventsCalendar();
    });
  </script>
</body>
</html>