<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alpha Tracker PRO</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <style>
    :root {
      --primary: #00c853;
      --primary-dark: #009624;
      --secondary: #536dfe;
      --accent: #ff4081;
      --bg-dark: #121212;
      --bg-card: #1e1e1e;
      --bg-hover: #2a2a2a;
      --text: #ffffff;
      --text-secondary: #b0b0b0;
      --border: #333333;
      --success: #4caf50;
      --warning: #ff9800;
      --danger: #f44336;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: var(--bg-dark);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      background: radial-gradient(circle at top right, #1a1a2e, #121212);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 1;
      min-width: 250px;
    }
    
    .logo h1 {
      font-size: clamp(1.5rem, 4vw, 2.2rem);
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }
    
    .logo-icon {
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      color: var(--primary);
    }
    
    .search-container {
      display: flex;
      gap: 15px;
      background: var(--bg-card);
      padding: 12px 20px;
      border-radius: 50px;
      box-shadow: var(--shadow);
      align-items: center;
      width: 100%;
      max-width: 400px;
      flex: 1;
    }
    
    .search-container i {
      color: var(--text-secondary);
    }
    
    .search-container input {
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 1rem;
      width: 100%;
      outline: none;
    }
    
    .language-switcher {
      display: flex;
      gap: 8px;
      margin-left: 15px;
    }
    
    .lang-btn {
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: var(--text);
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      min-width: 40px;
    }
    
    .lang-btn.active {
      background: var(--primary);
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: minmax(300px, 1fr) 2fr;
      grid-template-areas: "tokens chart";
      gap: 25px;
      margin-bottom: 30px;
      min-height: 70vh;
    }
    
    .tokens-card {
      grid-area: tokens;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .chart-container {
      grid-area: chart;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid var(--border);
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    
    .card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: clamp(1.1rem, 2vw, 1.4rem);
      font-weight: 600;
    }
    
    .card-title i {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }
    
    .gecko-icon { background: rgba(0, 200, 83, 0.15); color: var(--primary); }
    
    .refresh-btn {
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: var(--text-secondary);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .refresh-btn:hover {
      background: var(--primary);
      color: white;
      transform: rotate(90deg);
    }
    
    .list {
      list-style: none;
      flex-grow: 1;
      overflow-y: auto;
      min-height: 300px;
    }
    
    .list-item {
      padding: 15px;
      margin-bottom: 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 15px;
    }
    
    .list-item:hover {
      background: var(--bg-hover);
      transform: translateX(5px);
    }
    
    .token-info {
      display: flex;
      flex-direction: column;
      gap: 5px;
      flex: 1;
      min-width: 0;
    }
    
    .token-name {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: clamp(0.9rem, 2vw, 1rem);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .token-name img {
      flex-shrink: 0;
    }
    
    .token-symbol {
      color: var(--text-secondary);
      font-size: 0.85rem;
      flex-shrink: 0;
    }
    
    .token-price {
      font-weight: 600;
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      white-space: nowrap;
    }
    
    .price-change {
      font-size: 0.9rem;
      padding: 3px 8px;
      border-radius: 4px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .positive {
      color: var(--success);
      background: rgba(76, 175, 80, 0.15);
    }
    
    .negative {
      color: var(--danger);
      background: rgba(244, 67, 54, 0.15);
    }
    
    .action-btn {
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: var(--text);
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: clamp(0.8rem, 2vw, 0.9rem);
      white-space: nowrap;
    }
    
    .action-btn:hover {
      background: var(--primary);
    }
    
    .chart-container {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .chart-title {
      font-size: clamp(1.1rem, 2vw, 1.4rem);
      font-weight: 600;
    }
    
    .chart-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .time-btn {
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: var(--text);
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }
    
    .time-btn.active {
      background: var(--primary);
    }
    
    .chart-wrapper {
      height: 100%;
      position: relative;
      flex-grow: 1;
    }

    .chart-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(30, 30, 30, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      flex-direction: column;
      gap: 15px;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
      color: var(--text-secondary);
      flex-direction: column;
      gap: 15px;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }
    
    .error {
      background: rgba(244, 67, 54, 0.15);
      color: var(--danger);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin-top: 10px;
    }
    
    .empty-state {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
      color: var(--text-secondary);
      flex-direction: column;
      gap: 15px;
      text-align: center;
    }
    
    .empty-state i {
      font-size: 3rem;
      opacity: 0.3;
    }
    
    .token-link {
      display: flex;
      align-items: center;
      gap: 12px;
      color: inherit;
      text-decoration: none;
      width: 100%;
    }
    
    .token-link:hover {
      text-decoration: underline;
    }
    
    .token-info {
      width: 100%;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
        grid-template-areas: 
          "tokens"
          "chart";
        min-height: auto;
      }
      
      .tokens-card .list {
        max-height: 400px;
      }
    }
    
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-container {
        max-width: 100%;
      }
      
      .language-switcher {
        margin-left: 0;
        justify-content: center;
        width: 100%;
      }
      
      .chart-wrapper {
        height: 300px;
      }
      
      .list-item {
        padding: 12px;
        flex-wrap: wrap;
      }
      
      .token-name {
        flex-wrap: wrap;
        white-space: normal;
      }
      
      .action-btn {
        padding: 6px 10px;
      }
      
      .list-item > div:last-child {
        display: flex;
        flex-direction: row;
        width: 100%;
        justify-content: space-between;
        margin-top: 10px;
      }
      
      .token-link {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-actions {
        width: 100%;
        justify-content: center;
      }
      
      .chart-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .list-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .list-item > div:last-child {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }
      
      .action-btn {
        width: 100%;
        justify-content: center;
      }
    }
    
    /* Стили для секции с другими сайтами */
    .other-sites-section {
      margin-top: 40px;
      padding: 25px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
    }
    
    .other-sites-title {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 20px;
    }
    
    .other-sites-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: 1rem;
    }
    
    .other-sites-list a {
      color: var(--primary);
      text-decoration: underline;
    }
    
    /* Стили для кнопок управления графиком */
    .chart-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .chart-controls button {
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: var(--text);
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
    }
    
    .chart-controls button:hover {
      background: var(--primary);
    }
    
    .chart-summary {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      font-size: 0.9rem;
    }
    
    .chart-summary-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .chart-summary-label {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-bottom: 5px;
    }
    
    .chart-summary-value {
      font-weight: 600;
    }
    
    .positive-summary {
      color: var(--success);
    }
    
    .negative-summary {
      color: var(--danger);
    }
    
    .volume-chart {
      height: 80px;
      margin-top: 15px;
      position: relative;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-chart-line logo-icon"></i>
        <h1>Alpha Tracker PRO</h1>
      </div>
      <div style="display: flex; flex: 1; max-width: 600px; gap: 15px;">
        <div class="search-container">
          <i class="fas fa-search"></i>
          <input type="text" id="search" placeholder="Search tokens...">
        </div>
        <div class="language-switcher">
          <button class="lang-btn active" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="ru">RU</button>
          <button class="lang-btn" data-lang="uk">UK</button>
        </div>
      </div>
    </header>
    
    <div class="dashboard-grid">
      <!-- CoinGecko Section -->
      <div class="card tokens-card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-dragon gecko-icon"></i>
            <span id="gecko-title">New CoinGecko Tokens</span>
          </div>
          <button class="refresh-btn" id="refresh-gecko">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
        <ul class="list" id="gecko-list">
          <div class="loading">
            <div class="loading-spinner"></div>
            <div id="loading-text">Loading data...</div>
          </div>
        </ul>
      </div>
      
      <!-- Chart Section -->
      <div class="chart-container">
        <div class="chart-header">
          <div class="chart-title" id="chart-title">📈 Price Chart (7 days)</div>
          <div class="chart-actions">
            <button class="time-btn active" data-range="7" id="time-7">7 days</button>
            <button class="time-btn" data-range="30" id="time-30">30 days</button>
            <button class="time-btn" data-range="90" id="time-90">90 days</button>
            <button class="time-btn" data-range="365" id="time-365">1 year</button>
            <!-- Кнопка оновлення графіка -->
            <button class="refresh-btn" id="refresh-chart" title="Refresh Chart">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
        </div>
        <div class="chart-wrapper">
          <div id="chart-overlay" class="chart-overlay" style="display: none;">
            <div class="loading-spinner"></div>
            <div id="loading-chart-text">Loading chart...</div>
          </div>
          <canvas id="chart"></canvas>
        </div>
        
        <!-- Chart Summary -->
        <div class="chart-summary">
          <div class="chart-summary-item">
            <span class="chart-summary-label" id="current-price-label">Current Price</span>
            <span class="chart-summary-value" id="current-price">$0.00</span>
          </div>
          <div class="chart-summary-item">
            <span class="chart-summary-label" id="price-change-label">24h Change</span>
            <span class="chart-summary-value" id="price-change">0.00%</span>
          </div>
          <div class="chart-summary-item">
            <span class="chart-summary-label" id="ath-price-label">All-time High</span>
            <span class="chart-summary-value" id="ath-price">$0.00</span>
          </div>
        </div>
        
        <!-- Volume Chart -->
        <div class="volume-chart">
          <canvas id="volume-chart"></canvas>
        </div>
        
        <!-- Chart Controls -->
        <div class="chart-controls">
          <button id="zoom-in"><i class="fas fa-search-plus"></i> Zoom In</button>
          <button id="zoom-out"><i class="fas fa-search-minus"></i> Zoom Out</button>
          <button id="reset-zoom"><i class="fas fa-sync-alt"></i> Reset Zoom</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Секция с другими сайтами -->
  <div class="container">
    <section class="other-sites-section">
      <h2 id="other-sites-title" class="other-sites-title"></h2>
      <ul id="other-sites-list" class="other-sites-list"></ul>
    </section>
  </div>

  <script>
    // DOM elements
    const geckoList = document.getElementById("gecko-list");
    const chartEl = document.getElementById("chart");
    const volumeChartEl = document.getElementById("volume-chart");
    const searchInput = document.getElementById("search");
    const chartOverlay = document.getElementById("chart-overlay");
    
    // Summary elements
    const currentPriceEl = document.getElementById("current-price");
    const priceChangeEl = document.getElementById("price-change");
    const athPriceEl = document.getElementById("ath-price");
    
    // Language elements
    const langButtons = document.querySelectorAll('.lang-btn');
    const geckoTitle = document.getElementById('gecko-title');
    const loadingText = document.getElementById('loading-text');
    const loadingChartText = document.getElementById('loading-chart-text');
    const chartTitle = document.getElementById('chart-title');
    const timeBtn7 = document.getElementById('time-7');
    const timeBtn30 = document.getElementById('time-30');
    const timeBtn90 = document.getElementById('time-90');
    const timeBtn365 = document.getElementById('time-365');
    
    // Translations
    const translations = {
      en: {
        searchPlaceholder: "Search tokens...",
        geckoTitle: "New CoinGecko Tokens",
        loading: "Loading data...",
        loadingChart: "Loading chart...",
        error: "Error loading data. Please refresh the page.",
        emptyState: "No tokens found",
        chartTitle: "📈 Price Chart (7 days)",
        days7: "7 days",
        days30: "30 days",
        days90: "90 days",
        days365: "1 year",
        buttonChart: "Chart",
        otherSitesTitle: "🔗 Other Sites with New Tokens",
        otherSites: [
          { name: "CoinGecko Discover", url: "https://www.coingecko.com/en/discover" },
          { name: "CoinMarketCap New", url: "https://coinmarketcap.com/new/" },
          { name: "DEXTools Trending", url: "https://www.dextools.io/app/en/trending" },
          { name: "DexScreener", url: "https://dexscreener.com/" },
          { name: "TokenSniffer", url: "https://tokensniffer.com/" },
          { name: "GeckoTerminal", url: "https://www.geckoterminal.com/" },
          { name: "GemFinder", url: "https://www.gemfinder.cc/" },
          { name: "CoinScope New", url: "https://www.coinscope.co/new" }
        ],
        currentPrice: "Current Price",
        priceChange: "24h Change",
        athPrice: "All-time High",
        zoomIn: "Zoom In",
        zoomOut: "Zoom Out",
        resetZoom: "Reset Zoom",
        refreshChartTitle: "Refresh Chart",
        retryButton: "Retry"
      },
      ru: {
        searchPlaceholder: "Поиск токенов...",
        geckoTitle: "Новые токены CoinGecko",
        loading: "Загрузка данных...",
        loadingChart: "Загрузка графика...",
        error: "Ошибка загрузки данных. Пожалуйста, обновите страницу.",
        emptyState: "Токены не найдены",
        chartTitle: "📈 График цены (7 дней)",
        days7: "7 дней",
        days30: "30 дней",
        days90: "90 дней",
        days365: "1 год",
        buttonChart: "График",
        otherSitesTitle: "🔗 Другие сайты с новыми токенами",
        otherSites: [
          { name: "CoinGecko Discover", url: "https://www.coingecko.com/en/discover" },
          { name: "CoinMarketCap New", url: "https://coinmarketcap.com/new/" },
          { name: "DEXTools Trending", url: "https://www.dextools.io/app/en/trending" },
          { name: "DexScreener", url: "https://dexscreener.com/" },
          { name: "TokenSniffer", url: "https://tokensniffer.com/" },
          { name: "GeckoTerminal", url: "https://www.geckoterminal.com/" },
          { name: "GemFinder", url: "https://www.gemfinder.cc/" },
          { name: "CoinScope New", url: "https://www.coinscope.co/new" }
        ],
        currentPrice: "Текущая цена",
        priceChange: "Изменение за 24ч",
        athPrice: "Исторический максимум",
        zoomIn: "Приблизить",
        zoomOut: "Отдалить",
        resetZoom: "Сбросить",
        refreshChartTitle: "Обновить график",
        retryButton: "Повторить"
      },
      uk: {
        searchPlaceholder: "Пошук токенів...",
        geckoTitle: "Нові токени CoinGecko",
        loading: "Завантаження даних...",
        loadingChart: "Завантаження графіка...",
        error: "Помилка завантаження даних. Спробуйте оновити сторінку.",
        emptyState: "Токени не знайдені",
        chartTitle: "📈 Графік ціни (7 днів)",
        days7: "7 днів",
        days30: "30 днів",
        days90: "90 днів",
        days365: "1 рік",
        buttonChart: "Графік",
        otherSitesTitle: "🔗 Інші сайти з новими токенами",
        otherSites: [
          { name: "CoinGecko Discover", url: "https://www.coingecko.com/en/discover" },
          { name: "CoinMarketCap New", url: "https://coinmarketcap.com/new/" },
          { name: "DEXTools Trending", url: "https://www.dextools.io/app/en/trending" },
          { name: "DexScreener", url: "https://dexscreener.com/" },
          { name: "TokenSniffer", url: "https://tokensniffer.com/" },
          { name: "GeckoTerminal", url: "https://www.geckoterminal.com/" },
          { name: "GemFinder", url: "https://www.gemfinder.cc/" },
          { name: "CoinScope New", url: "https://www.coinscope.co/new" }
        ],
        currentPrice: "Поточна ціна",
        priceChange: "Зміна за 24г",
        athPrice: "Історичний максимум",
        zoomIn: "Збільшити",
        zoomOut: "Зменшити",
        resetZoom: "Скинути",
        refreshChartTitle: "Оновити графік",
        retryButton: "Спробувати знову"
      }
    };
    
    // Current language
    let currentLanguage = 'en';
    
    // Chart variables
    let chart;
    let volumeChart;
    let currentChartData = null;
    let currentChartRange = 7;
    let currentTokenId = 'bitcoin';
    let currentTokenData = null;
    
    // Data stores
    let geckoTokens = [];
    
    // Cache stores
    const tokenDataCache = {};
    const chartDataCache = {};
    
    // Auto-refresh variables
    let tokenRefreshInterval;
    let chartRefreshInterval;
    let isChartLoading = false;
    let isTokenLoading = false;
    
    // Set language
    function setLanguage(lang) {
      currentLanguage = lang;
      
      // Update UI elements
      searchInput.placeholder = translations[lang].searchPlaceholder;
      geckoTitle.textContent = translations[lang].geckoTitle;
      loadingText.textContent = translations[lang].loading;
      loadingChartText.textContent = translations[lang].loadingChart;
      timeBtn7.textContent = translations[lang].days7;
      timeBtn30.textContent = translations[lang].days30;
      timeBtn90.textContent = translations[lang].days90;
      timeBtn365.textContent = translations[lang].days365;
      
      // Update chart title with current range
      updateChartTitle(currentChartRange);
      
      // Update summary labels
      document.getElementById('current-price-label').textContent = translations[lang].currentPrice;
      document.getElementById('price-change-label').textContent = translations[lang].priceChange;
      document.getElementById('ath-price-label').textContent = translations[lang].athPrice;
      
      // Update chart controls
      document.getElementById('zoom-in').innerHTML = `<i class="fas fa-search-plus"></i> ${translations[lang].zoomIn}`;
      document.getElementById('zoom-out').innerHTML = `<i class="fas fa-search-minus"></i> ${translations[lang].zoomOut}`;
      document.getElementById('reset-zoom').innerHTML = `<i class="fas fa-sync-alt"></i> ${translations[lang].resetZoom}`;
      
      // Update refresh button title
      document.getElementById('refresh-chart').title = translations[lang].refreshChartTitle;
      
      // Re-render token list to update button texts
      if (geckoTokens.length > 0) {
        renderGeckoTokens(geckoTokens);
      }
      
      // Re-render chart if exists
      if (currentChartData) {
        renderChart(currentChartData, currentTokenId, currentChartRange);
      }
      
      // Render other sites section
      renderOtherSites();
    }
    
    // Render other sites section
    function renderOtherSites() {
      const titleElement = document.getElementById('other-sites-title');
      const listElement = document.getElementById('other-sites-list');
      
      if (!titleElement || !listElement) return;
      
      const langData = translations[currentLanguage];
      titleElement.textContent = langData.otherSitesTitle;
      
      // Clear the list
      listElement.innerHTML = '';
      
      // Fill the list
      langData.otherSites.forEach(site => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = site.url;
        a.target = "_blank";
        a.textContent = `🌐 ${site.name}`;
        li.appendChild(a);
        listElement.appendChild(li);
      });
    }
    
    // Update chart title with current range
    function updateChartTitle(days) {
      const rangeText = {
        7: translations[currentLanguage].days7,
        30: translations[currentLanguage].days30,
        90: translations[currentLanguage].days90,
        365: translations[currentLanguage].days365
      };
      chartTitle.textContent = `📈 ${translations[currentLanguage].chartTitle.split('(')[0].trim()} (${rangeText[days]})`;
    }
    
    // Format currency
    function formatCurrency(value) {
      if (value < 0.01) {
        return '$' + value.toFixed(6);
      }
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: value < 1 ? 4 : 2,
        maximumFractionDigits: value < 1 ? 6 : 2
      }).format(value);
    }
    
    // Format percentage
    function formatPercentage(value) {
      const sign = value >= 0 ? '+' : '';
      return sign + value.toFixed(2) + '%';
    }
    
    // Show loading state
    function showLoading(element) {
      element.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>${translations[currentLanguage].loading}</div>
        </div>
      `;
    }
    
    // Show error state
    function showError(element, message) {
      element.innerHTML = `
        <div class="error">
          <i class="fas fa-exclamation-circle"></i> ${message}
        </div>
      `;
    }
    
    // Show empty state
    function showEmptyState(element, message) {
      element.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-inbox"></i>
          <div>${message}</div>
        </div>
      `;
    }
    
    // Start auto-refresh
    function startAutoRefresh() {
      // Clear existing intervals
      stopAutoRefresh();
      
      // Refresh tokens every 5 minutes
      tokenRefreshInterval = setInterval(() => {
        if (!document.hidden && !isTokenLoading) {
          loadGecko();
        }
      }, 300000); // 5 minutes = 300000 ms
      
      // Refresh chart every minute
      chartRefreshInterval = setInterval(() => {
        if (!document.hidden && currentTokenId && !isChartLoading) {
          showTokenChart(currentTokenId, currentChartRange, null, true);
        }
      }, 60000); // 1 minute = 60000 ms
    }
    
    // Stop auto-refresh
    function stopAutoRefresh() {
      if (tokenRefreshInterval) clearInterval(tokenRefreshInterval);
      if (chartRefreshInterval) clearInterval(chartRefreshInterval);
    }
    
    // CoinGecko API
    async function loadGecko() {
      if (isTokenLoading) return;
      isTokenLoading = true;
      
      showLoading(geckoList);
      
      try {
        const response = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_asc&per_page=50&page=1&sparkline=true&price_change_percentage=24h");
        
        if (!response.ok) {
          throw new Error(translations[currentLanguage].error);
        }
        
        const data = await response.json();
        geckoTokens = data;
        
        // Filter with search query
        const searchValue = searchInput.value.toLowerCase();
        const filtered = searchValue ? 
          geckoTokens.filter(t => 
            t.name.toLowerCase().includes(searchValue) || 
            t.symbol.toLowerCase().includes(searchValue)
          ) : geckoTokens;
        
        renderGeckoTokens(filtered);
      } catch (error) {
        console.error("CoinGecko error:", error);
        showError(geckoList, translations[currentLanguage].error);
      } finally {
        isTokenLoading = false;
      }
    }
    
    function renderGeckoTokens(tokens) {
      if (!tokens || tokens.length === 0) {
        showEmptyState(geckoList, translations[currentLanguage].emptyState);
        return;
      }
      
      geckoList.innerHTML = tokens.map(token => {
        const priceChange = token.price_change_percentage_24h || 0;
        const changeClass = priceChange >= 0 ? 'positive' : 'negative';
        const changeSign = priceChange >= 0 ? '+' : '';
        
        return `
          <li class="list-item">
            <div class="token-info">
              <a href="https://www.coingecko.com/en/coins/${token.id}" target="_blank" class="token-link">
                <img src="${token.image}" alt="${token.name}" 
                     onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%23b0b0b0\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'><circle cx=\'12\' cy=\'12\' r=\'10\'></circle><line x1=\'12\' y1=\'8\' x2=\'12\' y2=\'12\'></line><line x1=\'12\' y1=\'16\' x2=\'12.01\' y2=\'16\'></line></svg>'" 
                     width="24" height="24">
                <div>
                  <div class="token-name">
                    ${token.name}
                    <span class="token-symbol">(${token.symbol.toUpperCase()})</span>
                  </div>
                  <div class="token-price">${formatCurrency(token.current_price)}</div>
                </div>
              </a>
            </div>
            <div>
              <div class="price-change ${changeClass}">
                ${priceChange === 0 ? '' : changeSign}${formatPercentage(priceChange)}
              </div>
              <button class="action-btn" onclick="showTokenChart('${token.id}', ${currentChartRange}, this)">
                <i class="fas fa-chart-line"></i> ${translations[currentLanguage].buttonChart}
              </button>
            </div>
          </li>
        `;
      }).join('');
    }
    
    // Chart functions
    async function showTokenChart(tokenId, days = 7, button = null, forceRefresh = false) {
      if (isChartLoading) return;
      isChartLoading = true;
      
      if (button) {
        document.querySelectorAll('.action-btn').forEach(btn => {
          btn.style.backgroundColor = '';
        });
        button.style.backgroundColor = 'rgba(0, 200, 83, 0.2)';
      }
      
      chartOverlay.style.display = 'flex';
      currentTokenId = tokenId;
      currentChartRange = days;
      
      // Update chart title with new range
      updateChartTitle(days);
      
      try {
        const cacheKey = `${tokenId}-${days}`;
        
        // Update token data only on first request or forced refresh
        if (forceRefresh || !tokenDataCache[tokenId]) {
          const tokenResponse = await fetch(`https://api.coingecko.com/api/v3/coins/${tokenId}`);
          if (!tokenResponse.ok) throw new Error(translations[currentLanguage].error);
          tokenDataCache[tokenId] = await tokenResponse.json();
        }
        
        currentTokenData = tokenDataCache[tokenId];
        
        // Update summary
        updateChartSummary(currentTokenData);
        
        // Update chart data only on first request or forced refresh
        if (forceRefresh || !chartDataCache[cacheKey]) {
          const response = await fetch(`https://api.coingecko.com/api/v3/coins/${tokenId}/market_chart?vs_currency=usd&days=${days}`);
          
          if (!response.ok) {
            throw new Error(translations[currentLanguage].error);
          }
          
          const data = await response.json();
          currentChartData = data;
          
          // Cache the data
          chartDataCache[cacheKey] = data;
        } else {
          currentChartData = chartDataCache[cacheKey];
        }
        
        renderChart(currentChartData, tokenId, days);
        chartOverlay.style.display = 'none';
      } catch (error) {
        console.error("Chart error:", error);
        chartOverlay.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-circle"></i> ${translations[currentLanguage].error}
            <button class="action-btn" style="margin-top: 10px;" onclick="showTokenChart('${tokenId}', ${days}, null, true)">
              <i class="fas fa-redo"></i> ${translations[currentLanguage].retryButton}
            </button>
          </div>
        `;
      } finally {
        isChartLoading = false;
      }
    }
    
    function updateChartSummary(tokenData) {
      if (!tokenData) return;
      
      const marketData = tokenData.market_data;
      if (!marketData) return;
      
      // Current price
      const currentPrice = marketData.current_price?.usd || 0;
      currentPriceEl.textContent = formatCurrency(currentPrice);
      
      // 24h price change
      const priceChange24h = marketData.price_change_percentage_24h || 0;
      priceChangeEl.textContent = formatPercentage(priceChange24h);
      priceChangeEl.className = priceChange24h >= 0 ? 'chart-summary-value positive-summary' : 'chart-summary-value negative-summary';
      
      // All-time high
      const ath = marketData.ath?.usd || 0;
      athPriceEl.textContent = formatCurrency(ath);
    }
    
    function renderChart(data, tokenId, days) {
      const prices = data.prices;
      
      // Determine date format based on range
      let dateFormat;
      if (days <= 7) {
        dateFormat = 'dd MMM';
      } else if (days <= 30) {
        dateFormat = 'dd MMM';
      } else {
        dateFormat = 'MMM yy';
      }
      
      const labels = prices.map(price => luxon.DateTime.fromMillis(price[0]).toFormat(dateFormat));
      const values = prices.map(price => price[1]);
      
      if (chart) {
        chart.destroy();
      }
      
      const ctx = chartEl.getContext('2d');
      
      // Create gradient for chart line
      const gradient = ctx.createLinearGradient(0, 0, 0, 400);
      gradient.addColorStop(0, 'rgba(0, 200, 83, 0.3)');
      gradient.addColorStop(1, 'rgba(0, 200, 83, 0)');
      
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: `${tokenId.toUpperCase()} ${translations[currentLanguage].buttonChart}`,
            data: values,
            borderColor: '#00c853',
            backgroundColor: gradient,
            borderWidth: 2,
            pointRadius: 0,
            pointHoverRadius: 5,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: 'rgba(30, 30, 30, 0.9)',
              titleColor: '#fff',
              bodyColor: '#ddd',
              titleFont: {
                size: 14
              },
              bodyFont: {
                size: 13
              },
              padding: 12,
              borderColor: 'rgba(255, 255, 255, 0.1)',
              borderWidth: 1,
              displayColors: false,
              callbacks: {
                title: function(tooltipItems) {
                  return luxon.DateTime.fromMillis(tooltipItems[0].parsed.x).toFormat('dd MMM yyyy, HH:mm');
                },
                label: function(context) {
                  return formatCurrency(context.parsed.y);
                }
              }
            },
            zoom: {
              pan: {
                enabled: true,
                mode: 'x',
                modifierKey: 'ctrl'
              },
              zoom: {
                wheel: {
                  enabled: true,
                },
                pinch: {
                  enabled: true
                },
                mode: 'x',
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: '#b0b0b0',
                maxRotation: 0,
                autoSkip: true,
                maxTicksLimit: 10
              }
            },
            y: {
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: '#b0b0b0',
                callback: function(value) {
                  return '$' + value.toFixed(2);
                }
              }
            }
          },
          interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
          },
          animation: {
            duration: 1000,
            easing: 'easeOutQuart'
          }
        }
      });
      
      // Render volume chart
      renderVolumeChart(data);
    }
    
    function renderVolumeChart(data) {
      if (volumeChart) {
        volumeChart.destroy();
      }
      
      const volumes = data.total_volumes;
      if (!volumes || volumes.length === 0) return;
      
      const ctx = volumeChartEl.getContext('2d');
      
      volumeChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: volumes.map(v => luxon.DateTime.fromMillis(v[0]).toFormat('dd MMM')),
          datasets: [{
            label: 'Volume',
            data: volumes.map(v => v[1]),
            backgroundColor: 'rgba(83, 109, 254, 0.6)',
            borderColor: 'rgba(83, 109, 254, 1)',
            borderWidth: 1,
            borderRadius: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                title: function(tooltipItems) {
                  return luxon.DateTime.fromMillis(volumes[tooltipItems[0].dataIndex][0]).toFormat('dd MMM yyyy');
                },
                label: function(context) {
                  return `Volume: $${context.parsed.y.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
                }
              }
            }
          },
          scales: {
            x: {
              display: false
            },
            y: {
              display: false
            }
          }
        }
      });
    }
    
    // Event listeners
    searchInput.addEventListener('input', e => {
      const val = e.target.value.toLowerCase();
      const filtered = geckoTokens.filter(t => 
        t.name.toLowerCase().includes(val) || 
        t.symbol.toLowerCase().includes(val)
      );
      renderGeckoTokens(filtered);
    });
    
    // Refresh buttons
    document.getElementById('refresh-gecko').addEventListener('click', loadGecko);
    
    // Time range buttons
    document.querySelectorAll('.time-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const range = parseInt(this.dataset.range);
        if (currentTokenId) {
          showTokenChart(currentTokenId, range);
        }
      });
    });
    
    // Language switcher
    langButtons.forEach(button => {
      button.addEventListener('click', function() {
        langButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        setLanguage(this.dataset.lang);
      });
    });
    
    // Chart controls
    document.getElementById('zoom-in').addEventListener('click', () => {
      if (chart) {
        chart.zoom(1.1);
      }
    });
    
    document.getElementById('zoom-out').addEventListener('click', () => {
      if (chart) {
        chart.zoom(0.9);
      }
    });
    
    document.getElementById('reset-zoom').addEventListener('click', () => {
      if (chart) {
        chart.resetZoom();
      }
    });
    
    // Chart refresh button
    document.getElementById('refresh-chart').addEventListener('click', function() {
      if (currentTokenId) {
        showTokenChart(currentTokenId, currentChartRange, null, true);
      }
    });
    
    // Visibility change handler
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        // Refresh when tab becomes visible
        loadGecko();
        if (currentTokenId) {
          showTokenChart(currentTokenId, currentChartRange, null, true);
        }
      }
    });
    
    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
      // Set default language to English
      setLanguage('en');
      
      loadGecko();
      
      // Show default chart with Bitcoin
      setTimeout(() => {
        showTokenChart('bitcoin', 7);
      }, 1500);
      
      // Render other sites initially
      renderOtherSites();
      
      // Start auto-refresh
      startAutoRefresh();
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      stopAutoRefresh();
    });
  </script>
</body>
</html>